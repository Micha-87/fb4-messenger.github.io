const express=require("express"),bodyParser=require("body-parser"),compression=require("compression");let app=express(),server=require("http").Server(app),io=require("socket.io")(server);server.listen(3e3);let db=require("./js/database/db"),user=require("./js/database/user"),message=require("./js/database/message"),pushkey=require("./js/database/pushkey"),subscription=require("./js/database/subscription");app.use(compression()),app.use(function(e,s,r){s.header("Access-Control-Allow-Origin","*"),s.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),r()}),app.use(express.static(__dirname+"/")),io.sockets.on("connection",function(e){e.on("message",function(e){io.emit("add-message",e)}),e.on("db-changes",function(e){io.emit("db-changes-register",e)}),e.on("user-nickname-changes",function(e){io.emit("user-nickname-changes-everywhere",e)}),e.on("user-name-changes",function(e){io.emit("user-name-changes-everywhere",e)}),e.on("user-email-changes",function(e){io.emit("user-email-changes-everywhere",e)}),e.on("user-password-changes",function(e){io.emit("user-password-changes-everywhere",e)})}),app.use(bodyParser.urlencoded({extended:!0})),app.use(bodyParser.json()),app.post("/users/",user.createUsers),app.put("/users/loggedin/:id",user.updateUserState),app.put("/users/updateNickname/:id",user.updateUserNickname),app.put("/users/updateName/:id",user.updateUserName),app.put("/users/updateEmail/:id",user.updateUserEmail),app.put("/users/updatePassword/:id",user.updateUserPassword),app.get("/users/",user.seeResults),app.get("/users/getByEmail/:email",user.findByEmail),app.get("/users/getByNickname/:nickname",user.findByNickname),app.delete("/users/:id",user.delete),app.post("/messages/",message.createMessage),app.get("/messages/",message.getMassages),app.get("/pushkeys/",pushkey.getPushKeys),app.post("/add-subscription/",subscription.addSubscription),app.get("/subscriptions/",subscription.getSubscriptions),app.get("*",function(e,s){s.sendFile(__dirname+"/index.html")});